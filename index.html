<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Planilha Mensal</title>

<style>
body{
  font-family: Arial, sans-serif;
   background:url("igreja.jpg") center/cover no-repeat fixed;
  padding:20px;
}

.topo{
  display:flex;
  gap:10px;
  margin-bottom:15px;
  align-items:center;
}

button{
  padding:6px 10px;
  cursor:pointer;
}

table{
  border-collapse:collapse;
  width:100%;
  background:#fff;
}

th, td{
  border:1px solid #ccc;
  text-align:center;
  padding:6px;
}

th{
  background:#eee;
}

.acao-box{
  display:flex;
  gap:5px;
  align-items:center;
}

.acao-input{
  width:100%;
  padding:4px;
}

.remover{
  background:#f44336;
  color:#fff;
  border:none;
}

.feito{
  background:#4CAF50;
  color:#fff;
}

.parcial{
  background:#FFC107;
}

.nao{
  background:#F44336;
  color:#fff;
}

.status-box{
  position:fixed;
  top:50%;
  left:50%;
  transform:translate(-50%, -50%);
  background:#fff;
  border:1px solid #ccc;
  padding:15px;
  display:none;
  z-index:10;
}
</style>
</head>

<body>

<div class="topo">
  <select id="pessoa">
    <option value="Eduardo">Eduardo</option>
    <option value="Alessandra">Alessandra</option>
  </select>

  <select id="mes"></select>
  <select id="ano"></select>

  <button onclick="adicionarLinha()">âž• AÃ§Ã£o</button>
  <button onclick="salvar()">ðŸ’¾ Salvar</button>
</div>

<table>
  <thead>
    <tr>
      <th>AÃ§Ã£o</th>
      <script>
        for(let i=1;i<=31;i++){
          document.write(`<th>${i}</th>`);
        }
      </script>
    </tr>
  </thead>
  <tbody id="corpo"></tbody>
</table>

<div class="status-box" id="statusBox">
  <p>Escolha o status:</p>
  <button onclick="setStatus('feito')">Feito</button>
  <button onclick="setStatus('parcial')">Parcial</button>
  <button onclick="setStatus('nao')">NÃ£o concluÃ­do</button>
  <br><br>
  <button onclick="fecharBox()">Cancelar</button>
</div>

<script>
const corpo = document.getElementById("corpo");
const pessoaSel = document.getElementById("pessoa");
const mesSel = document.getElementById("mes");
const anoSel = document.getElementById("ano");

let celulaAtual = null;

// meses
const meses = ["Janeiro","Fevereiro","MarÃ§o","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"];
meses.forEach((m,i)=>mesSel.innerHTML+=`<option value="${i}">${m}</option>`);

// anos a partir do atual
const anoAtual = new Date().getFullYear();
for(let a=anoAtual; a<=anoAtual+5; a++){
  anoSel.innerHTML+=`<option value="${a}">${a}</option>`;
}

function chave(){
  return `${pessoaSel.value}_${mesSel.value}_${anoSel.value}`;
}

function adicionarLinha(dados=null){
  let tr = document.createElement("tr");

  let tdAcao = document.createElement("td");
  let box = document.createElement("div");
  box.className="acao-box";

  let input = document.createElement("input");
  input.className="acao-input";
  input.placeholder="Digite a aÃ§Ã£o";

  let btnRemover = document.createElement("button");
  btnRemover.innerText="X";
  btnRemover.className="remover";
  btnRemover.onclick=()=>{
    tr.remove();
    salvar();
  };

  box.appendChild(input);
  box.appendChild(btnRemover);
  tdAcao.appendChild(box);
  tr.appendChild(tdAcao);

  for(let i=0;i<31;i++){
    let td = document.createElement("td");
    td.onclick=()=>abrirBox(td);
    tr.appendChild(td);
  }

  corpo.appendChild(tr);

  if(dados){
    input.value = dados.acao;
    tr.querySelectorAll("td:not(:first-child)").forEach((td,i)=>{
      td.className = dados.dias[i];
    });
  }
}

function abrirBox(td){
  celulaAtual = td;
  document.getElementById("statusBox").style.display="block";
}

function fecharBox(){
  document.getElementById("statusBox").style.display="none";
}

function setStatus(status){
  celulaAtual.className = status;
  fecharBox();
}

function salvar(){
  let dados=[];
  document.querySelectorAll("#corpo tr").forEach(tr=>{
    let linha={
      acao: tr.querySelector("input").value,
      dias:[]
    };
    tr.querySelectorAll("td:not(:first-child)").forEach(td=>{
      linha.dias.push(td.className||"");
    });
    dados.push(linha);
  });
  localStorage.setItem(chave(), JSON.stringify(dados));
  alert("Salvo com sucesso!");
}

function carregar(){
  corpo.innerHTML="";
  let dados = JSON.parse(localStorage.getItem(chave()));
  if(dados){
    dados.forEach(l=>adicionarLinha(l));
  }else{
    adicionarLinha();
  }
}

pessoaSel.onchange=carregar;
mesSel.onchange=carregar;
anoSel.onchange=carregar;

carregar();
</script>

</body>
</html>

