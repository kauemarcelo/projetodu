<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Hor√°rio Espiritual</title>

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:url("igreja.jpg")
             center/cover no-repeat fixed;
}

.header{
  background:rgba(255,255,255,0.75);
  padding:10px;
  text-align:center;
  font-size:20px;
  font-weight:bold;
}

.top-controls{
  background:rgba(255,255,255,0.85);
  margin:10px 15px;
  padding:8px;
  border-radius:6px;
  text-align:center;
}

.top-controls select,
.top-controls button{
  padding:6px 10px;
  margin:0 4px;
  cursor:pointer;
}

.container{
  background:rgba(255,255,255,0.85);
  margin:15px;
  padding:10px;
  border-radius:6px;
  overflow-x:auto;
}

table{
  width:max-content;
  border-collapse:collapse;
}

th,td{
  border:1px solid #999;
  padding:3px;
  font-size:12px;
  text-align:center;
}

th{ background:#eee; }

.categoria{
  background:#ddd;
  font-weight:bold;
  text-align:left;
  padding-left:8px;
}

.acao-input{
  width:90%;
  border:none;
  background:transparent;
  font-weight:bold;
}

.btn{
  cursor:pointer;
  font-weight:bold;
  margin-left:6px;
}

.btn.add{ color:#3b5cff; }
.btn.del{ color:#e53935; }

.dia{
  width:24px;
  height:24px;
  cursor:pointer;
  background:#f0f0f0;
}

.verde{ background:#4CAF50; }
.amarelo{ background:#FFC107; }
.vermelho{ background:#F44336; }

/* modal */
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.4);
  display:none;
  align-items:center;
  justify-content:center;
}

.modal-box{
  background:#fff;
  padding:15px;
  border-radius:6px;
  text-align:center;
}

.modal-box button{
  margin:5px;
  padding:6px 10px;
}
</style>
</head>

<body>

<div class="header">HOR√ÅRIO ESPIRITUAL</div>

<div class="top-controls">
  M√™s:
  <select id="mes">
    <option>Janeiro</option><option>Fevereiro</option><option>Mar√ßo</option>
    <option>Abril</option><option>Maio</option><option>Junho</option>
    <option>Julho</option><option>Agosto</option><option>Setembro</option>
    <option>Outubro</option><option>Novembro</option><option>Dezembro</option>
  </select>

  Ano:
  <select id="ano"></select>

  <button onclick="salvar()">üíæ Salvar</button>
</div>

<div class="container">
<table id="tabela">

<thead>
<tr>
  <th>A√á√ÉO</th>
  <script>
    for(let i=1;i<=31;i++) document.write("<th>"+i+"</th>");
  </script>
</tr>
</thead>

<tbody id="corpo"></tbody>

</table>
</div>

<!-- MODAL -->
<div class="modal" id="modal">
  <div class="modal-box">
    <p>Escolha o status</p>
    <button onclick="setStatus('verde')" style="background:#4CAF50">Verde</button>
    <button onclick="setStatus('amarelo')" style="background:#FFC107">Amarelo</button>
    <button onclick="setStatus('vermelho')" style="background:#F44336">Vermelho</button>
    <button onclick="setStatus('')">Limpar</button>
  </div>
</div>

<script>
const categorias = [
  "Vincula√ß√£o comigo mesmo",
  "Vincula√ß√£o com Deus",
  "Vincula√ß√£o com os outros",
  "Vincula√ß√£o com o trabalho"
];

let celulaAtual = null;

/* ano */
const anoSel = document.getElementById("ano");
const anoAtual = new Date().getFullYear();
for(let a=anoAtual-2;a<=anoAtual+5;a++){
  anoSel.innerHTML += `<option>${a}</option>`;
}

/* monta tabela */
function montar(dados=null){
  const corpo = document.getElementById("corpo");
  corpo.innerHTML = "";

  categorias.forEach((cat,ci)=>{
    corpo.innerHTML += `
      <tr>
        <td class="categoria" colspan="32">
          ${cat}
          <span class="btn add" onclick="addAcao(this)">+</span>
        </td>
      </tr>
    `;

    const acoes = dados?.[ci] || Array(3).fill({texto:"",dias:[]});

    acoes.forEach(acao=>{
      let row = document.createElement("tr");
      row.className="acao-row";

      let html = `
        <td>
          <input class="acao-input" value="${acao.texto || ""}">
          <span class="btn del" onclick="removeAcao(this)">‚úñ</span>
        </td>
      `;

      for(let d=0;d<31;d++){
        html += `<td class="dia ${acao.dias?.[d]||""}"></td>`;
      }

      row.innerHTML = html;
      corpo.appendChild(row);
      aplicarClique(row);
    });
  });
}

/* clique dia */
function aplicarClique(linha){
  linha.querySelectorAll(".dia").forEach(c=>{
    c.onclick = ()=>{
      celulaAtual = c;
      document.getElementById("modal").style.display="flex";
    };
  });
}

function setStatus(st){
  celulaAtual.className = "dia " + st;
  document.getElementById("modal").style.display="none";
}

/* add/remove */
function addAcao(btn){
  const tr = btn.closest("tr");
  const nova = document.createElement("tr");
  nova.className="acao-row";

  let html = `
    <td>
      <input class="acao-input">
      <span class="btn del" onclick="removeAcao(this)">‚úñ</span>
    </td>
  `;
  for(let i=0;i<31;i++) html+=`<td class="dia"></td>`;

  nova.innerHTML = html;
  tr.after(nova);
  aplicarClique(nova);
}

function removeAcao(btn){
  btn.closest("tr").remove();
}

/* salvar */
function salvar(){
  const key = document.getElementById("mes").value+"-"+document.getElementById("ano").value;
  const dados = [];
  let idx = -1;

  document.querySelectorAll("#corpo tr").forEach(tr=>{
    if(tr.querySelector(".categoria")){
      dados[++idx]=[];
    }else{
      const texto = tr.querySelector(".acao-input").value;
      const dias = [...tr.querySelectorAll(".dia")].map(d=>{
        d.classList.contains("verde")?"verde":
        d.classList.contains("amarelo")?"amarelo":
        d.classList.contains("vermelho")?"vermelho":""
      });
      dados[idx].push({texto,dias});
    }
  });

  localStorage.setItem(key,JSON.stringify(dados));
  alert("Salvo com sucesso ‚úîÔ∏è");
}

/* carregar */
function carregar(){
  const key = document.getElementById("mes").value+"-"+document.getElementById("ano").value;
  const dados = JSON.parse(localStorage.getItem(key));
  montar(dados);
}

document.getElementById("mes").onchange = carregar;
document.getElementById("ano").onchange = carregar;

montar();
</script>

</body>
</html>
