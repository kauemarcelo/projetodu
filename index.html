<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Hor√°rio Espiritual</title>

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:#1e1e2f;
}

.header{
  background:rgba(255,255,255,0.9);
  padding:12px;
  text-align:center;
  font-size:20px;
  font-weight:bold;
}

.topo{
  background:#fff;
  margin:10px;
  padding:10px;
  border-radius:6px;
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  align-items:center;
  justify-content:space-between;
}

.topo select,
.topo button{
  padding:6px;
  font-size:14px;
}

.container{
  background:#fff;
  margin:10px;
  padding:10px;
  border-radius:6px;
  overflow-x:auto;
}

table{
  border-collapse:collapse;
  width:100%;
}

th,td{
  border:1px solid #999;
  padding:4px;
  font-size:12px;
  text-align:center;
}

th{ background:#eee; }

.categoria{
  background:#ddd;
  font-weight:bold;
  text-align:left;
  padding-left:8px;
}

.acao-box{
  display:flex;
  align-items:center;
  gap:5px;
}

.acao-input{
  flex:1;
  border:none;
  background:transparent;
  font-weight:bold;
}

.btn{
  cursor:pointer;
  font-weight:bold;
}

.add{ color:#2a5cff; }
.del{ color:#e53935; }

.dia{
  width:26px;
  height:26px;
  cursor:pointer;
  background:#f0f0f0;
}

.verde{ background:#4CAF50; }
.amarelo{ background:#FFC107; }
.vermelho{ background:#F44336; }

/* MODAL */
.modal{
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  background:rgba(0,0,0,0.5);
  display:none;
  align-items:center;
  justify-content:center;
}

.status-box{
  background:#fff;
  padding:15px;
  border-radius:8px;
  text-align:center;
  width:260px;
}

.status-box button{
  width:100%;
  padding:8px;
  margin:6px 0;
  font-size:15px;
  cursor:pointer;
  border:none;
  border-radius:4px;
  color:#fff;
}

/* MOBILE */
@media (max-width:768px){
  .topo{
    flex-direction:column;
    align-items:stretch;
  }

  .topo select,
  .topo button{
    width:100%;
    font-size:16px;
  }

  table{
    display:block;
    overflow-x:auto;
    white-space:nowrap;
  }
}
</style>
</head>

<body>

<div class="header">HOR√ÅRIO ESPIRITUAL</div>

<div class="topo">
  <select id="pessoa">
    <option value="Eduardo">Eduardo</option>
    <option value="Alessandra">Alessandra</option>
  </select>

  <select id="mes"></select>
  <select id="ano"></select>

  <button onclick="salvar()">üíæ Salvar</button>
</div>

<div class="container">
<table id="tabela">

<thead>
<tr>
  <th>A√á√ÉO</th>
  <script>
    for(let i=1;i<=31;i++) document.write(`<th>${i}</th>`);
  </script>
</tr>
</thead>

<tbody id="corpo"></tbody>

</table>
</div>

<!-- MODAL -->
<div class="modal" id="modal">
  <div class="status-box">
    <h3>Status</h3>
    <button style="background:#4CAF50" onclick="setStatus('verde')">Feito</button>
    <button style="background:#FFC107" onclick="setStatus('amarelo')">Parcial</button>
    <button style="background:#F44336" onclick="setStatus('vermelho')">N√£o conclu√≠do</button>
    <button style="background:#777" onclick="setStatus('')">Limpar</button>
  </div>
</div>

<script>
const categorias = [
  "Vincula√ß√£o comigo mesmo",
  "Vincula√ß√£o com Deus",
  "Vincula√ß√£o com os outros",
  "Vincula√ß√£o com o trabalho"
];

const corpo = document.getElementById("corpo");
let celulaAtual = null;

/* MES / ANO */
const meses = ["Janeiro","Fevereiro","Mar√ßo","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"];
const mesSel = document.getElementById("mes");
const anoSel = document.getElementById("ano");

meses.forEach((m,i)=> mesSel.innerHTML += `<option value="${i}">${m}</option>`);

const anoAtual = new Date().getFullYear();
for(let a=anoAtual;a<=anoAtual+5;a++) anoSel.innerHTML += `<option>${a}</option>`;

/* CRIAR TABELA */
function montar(){
  corpo.innerHTML="";
  categorias.forEach(cat=>{
    corpo.innerHTML+=`
      <tr>
        <td class="categoria" colspan="32">
          ${cat}
          <span class="btn add" onclick="addAcao(this)"> +</span>
        </td>
      </tr>
    `;
    addAcao();
  });
}

function addAcao(btn){
  const tr=document.createElement("tr");
  tr.innerHTML=`
    <td>
      <div class="acao-box">
        <input class="acao-input" placeholder="Digite a a√ß√£o">
        <span class="btn del" onclick="this.closest('tr').remove()">‚úñ</span>
      </div>
    </td>
  `;
  for(let i=1;i<=31;i++){
    const td=document.createElement("td");
    td.className="dia";
    td.onclick=()=>abrirModal(td);
    tr.appendChild(td);
  }
  if(btn) btn.closest("tr").after(tr);
  else corpo.appendChild(tr);
}

/* MODAL */
function abrirModal(td){
  celulaAtual=td;
  document.getElementById("modal").style.display="flex";
}

function setStatus(st){
  celulaAtual.className="dia "+st;
  document.getElementById("modal").style.display="none";
}

/* SALVAR */
function salvar(){
  const dados=[];
  document.querySelectorAll(".acao-row, tbody tr").forEach(tr=>{
    const input=tr.querySelector(".acao-input");
    if(!input) return;
    const dias=[];
    tr.querySelectorAll(".dia").forEach(d=>{
      dias.push(d.className.replace("dia","").trim());
    });
    dados.push({acao:input.value,dias});
  });

  const chave = pessoa.value+"-"+mes.value+"-"+ano.value;
  localStorage.setItem(chave, JSON.stringify(dados));
  alert("Salvo com sucesso ‚úÖ");
}

/* CARREGAR */
function carregar(){
  montar();
  const chave = pessoa.value+"-"+mes.value+"-"+ano.value;
  const dados = JSON.parse(localStorage.getItem(chave) || "[]");
  const linhas=document.querySelectorAll(".acao-input");

  dados.forEach((d,i)=>{
    if(!linhas[i]) return;
    linhas[i].value=d.acao;
    const dias=linhas[i].closest("tr").querySelectorAll(".dia");
    d.dias.forEach((st,j)=>{
      if(st) dias[j].classList.add(st);
    });
  });
}

["change"].forEach(e=>{
  pessoa.addEventListener(e,carregar);
  mesSel.addEventListener(e,carregar);
  anoSel.addEventListener(e,carregar);
});

montar();
carregar();
</script>

</body>
</html>
