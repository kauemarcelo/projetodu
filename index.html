<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hor√°rio Espiritual</title>

<style>
* { box-sizing: border-box; font-family: Arial, sans-serif; }

body {
  margin: 0;
  background: #f4f4f4;
}

/* LOGIN */
.login {
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}

.login-box {
  background:#fff;
  padding:30px;
  border-radius:10px;
  width:300px;
  text-align:center;
  box-shadow:0 0 15px rgba(0,0,0,0.2);
}

.login-box input {
  width:100%;
  padding:10px;
  margin:6px 0;
}

.login-box button {
  width:100%;
  padding:10px;
  margin-top:6px;
  cursor:pointer;
}

/* SISTEMA */
.sistema { display:none; }

.header {
  background: #fff;
  padding: 12px;
  text-align: center;
  font-weight: bold;
  font-size: 20px;
}

.header button {
  margin-left:8px;
}

.controls {
  background: #fff;
  margin: 10px;
  padding: 10px;
  border-radius: 8px;
}

.controls select, .controls button {
  width: 100%;
  padding: 10px;
  margin-top: 6px;
  font-size: 16px;
}

.container {
  background: #fff;
  margin: 10px;
  padding: 10px;
  border-radius: 8px;
  overflow-x: auto;
}

table {
  border-collapse: collapse;
  width: max-content;
}

th, td {
  border: 1px solid #ccc;
  padding: 4px;
  text-align: center;
  font-size: 13px;
}

.categoria {
  background: #ddd;
  font-weight: bold;
  text-align: left;
  padding-left: 8px;
}

.acao-cell { min-width: 160px; }

.acao-input {
  width: 100%;
  border: none;
  font-weight: bold;
  font-size: 14px;
}

.btn { cursor: pointer; font-weight: bold; margin-left: 6px; }
.btn.add { color: #2f5cff; }
.btn.del { color: #e53935; }

.dia { width: 26px; height: 26px; cursor: pointer; background: #f0f0f0; }

.feito { background: #4CAF50 !important; }
.parcial { background: #FFC107 !important; }
.nao { background: #F44336 !important; }

.modal {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.4);
  display: none;
  align-items: center;
  justify-content: center;
}

.modal-box {
  background: #fff;
  padding: 16px;
  border-radius: 10px;
  width: 90%;
  max-width: 320px;
  text-align: center;
}

.modal-box button {
  width: 100%;
  padding: 10px;
  margin-top: 6px;
  font-size: 16px;
  cursor: pointer;
}
</style>
</head>

<body>

<!-- LOGIN -->
<div class="login" id="loginTela">
  <div class="login-box">
    <h3>Login</h3>
    <input type="text" id="usuario" placeholder="Usu√°rio">
    <input type="password" id="senha" placeholder="Senha">
    <button onclick="logar()">Entrar</button>
    <button onclick="cadastrar()">Cadastrar</button>
  </div>
</div>

<!-- SISTEMA -->
<div class="sistema" id="sistema">

<div class="header">
  HOR√ÅRIO ESPIRITUAL - <span id="nomeUsuario"></span>
  <button onclick="alterarSenha()">Alterar Senha</button>
  <button id="btnExcluir" onclick="excluirUsuario()" style="display:none;">
    Excluir Usu√°rio
  </button>
  <button onclick="sair()">Sair</button>
</div>

<div class="controls">
  <select id="mes">
    <option>Janeiro</option><option>Fevereiro</option><option>Mar√ßo</option>
    <option>Abril</option><option>Maio</option><option>Junho</option>
    <option>Julho</option><option>Agosto</option><option>Setembro</option>
    <option>Outubro</option><option>Novembro</option><option>Dezembro</option>
  </select>

  <select id="ano"></select>

  <button onclick="salvar()">üíæ Salvar</button>
</div>

<div class="container">
<table>
<thead>
<tr>
  <th>A√á√ÉO</th>
  <script>
    for(let i=1;i<=31;i++) document.write(`<th>${i}</th>`);
  </script>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>
</div>

</div>

<!-- MODAL -->
<div class="modal" id="modal">
  <div class="modal-box">
    <p>Status do dia</p>
    <button onclick="setStatus('feito')" style="background:#4CAF50;color:#fff">Feito</button>
    <button onclick="setStatus('parcial')" style="background:#FFC107">Parcial</button>
    <button onclick="setStatus('nao')" style="background:#F44336;color:#fff">N√£o conclu√≠do</button>
    <button onclick="setStatus('')">Limpar</button>
  </div>
</div>

<script>

// ===== USU√ÅRIOS =====
let usuarios = JSON.parse(localStorage.getItem("usuarios")) || {
  "Eduardo": { senha: "123", master: true }
};

let usuarioLogado = null;

// ===== LOGIN =====
function logar(){
  const u = usuario.value;
  const s = senha.value;

  if(usuarios[u] && usuarios[u].senha === s){
    usuarioLogado = u;
    nomeUsuario.innerText = u;

    loginTela.style.display = "none";
    sistema.style.display = "block";

    carregar();
    mostrarMaster();
  } else {
    alert("Usu√°rio ou senha incorretos!");
  }
}

function cadastrar(){
  const novo = prompt("Nome do novo usu√°rio:");
  if(!novo) return;

  if(usuarios[novo]){
    alert("Usu√°rio j√° existe!");
    return;
  }

  usuarios[novo] = { senha: "123", master: false };
  localStorage.setItem("usuarios", JSON.stringify(usuarios));

  alert("Usu√°rio criado com senha padr√£o: 123");
}

function alterarSenha(){
  const nova = prompt("Nova senha:");
  if(!nova) return;

  usuarios[usuarioLogado].senha = nova;
  localStorage.setItem("usuarios", JSON.stringify(usuarios));

  alert("Senha alterada!");
}

function excluirUsuario(){
  const alvo = prompt("Qual usu√°rio deseja excluir?");
  if(!alvo || alvo === "Eduardo") return alert("N√£o pode excluir o master!");

  delete usuarios[alvo];
  localStorage.setItem("usuarios", JSON.stringify(usuarios));

  alert("Usu√°rio exclu√≠do!");
}

function mostrarMaster(){
  if(usuarios[usuarioLogado].master){
    btnExcluir.style.display = "inline-block";
  }
}

function sair(){
  location.reload();
}

// ===== TABELA =====
const categorias = [
  "Vincula√ß√£o comigo mesmo",
  "Vincula√ß√£o com Deus",
  "Vincula√ß√£o com os outros",
  "Vincula√ß√£o com o trabalho"
];

let celulaAtual = null;

function montarTabela(){
  tbody.innerHTML = "";
  categorias.forEach(cat=>{
    tbody.innerHTML += `
      <tr>
        <td class="categoria" colspan="32">
          ${cat}
          <span class="btn add" onclick="addAcao(this)">+</span>
        </td>
      </tr>
      ${linhaAcao()}
    `;
  });
  aplicarClique();
}

function linhaAcao(){
  let html = `<tr>
    <td class="acao-cell">
      <input class="acao-input" placeholder="Digite a a√ß√£o">
      <span class="btn del" onclick="this.closest('tr').remove()">‚úñ</span>
    </td>`;
  for(let i=1;i<=31;i++) html += `<td class="dia"></td>`;
  return html + "</tr>";
}

function addAcao(btn){
  btn.closest("tr").insertAdjacentHTML("afterend", linhaAcao());
  aplicarClique();
}

function aplicarClique(){
  document.querySelectorAll(".dia").forEach(c=>{
    c.onclick = ()=>{
      celulaAtual = c;
      modal.style.display = "flex";
    };
  });
}

function setStatus(status){
  celulaAtual.className = "dia " + status;
  modal.style.display = "none";
}

function salvar(){
  document.querySelectorAll(".acao-input").forEach(input=>{
    input.setAttribute("value", input.value);
  });

  const key = usuarioLogado + mes.value + ano.value;
  localStorage.setItem(key, tbody.innerHTML);

  alert("Salvo!");
}

function carregar(){
  const key = usuarioLogado + mes.value + ano.value;
  const dados = localStorage.getItem(key);

  if(dados){
    tbody.innerHTML = dados;
    aplicarClique();
  } else {
    montarTabela();
  }
}

// ANO
const atual = new Date().getFullYear();
for(let a=atual;a<=atual+5;a++) ano.innerHTML += `<option>${a}</option>`;

mes.onchange = ano.onchange = carregar;

</script>

</body>
</html>
