<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Hor√°rio Espiritual</title>

<style>
body {
    font-family: Arial, sans-serif;
    margin: 20px;
}

h2 {
    text-align: center;
}

.controls {
    text-align: center;
    margin-bottom: 10px;
}

select, input {
    padding: 6px;
    margin: 4px;
}

button {
    margin: 4px;
    padding: 6px 12px;
    cursor: pointer;
}

table {
    width: 100%;
    border-collapse: collapse;
    font-size: 12px;
}

th, td {
    border: 1px solid #000;
    text-align: center;
    padding: 4px;
    min-width: 28px;
}

th {
    background: #f0f0f0;
}

.section {
    background: #d9d9d9;
    font-weight: bold;
}

.editable {
    cursor: pointer;
}

.editable:hover {
    background: #ffffcc;
}

/* MODAL */
.modal {
    display: none;
    position: fixed;
    z-index: 999;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.6);
}

.modal-content {
    background: #fff;
    padding: 20px;
    width: 280px;
    margin: 20% auto;
    border-radius: 6px;
    text-align: center;
}

@media print {
    .controls { display: none; }
}
</style>
</head>

<body>

<h2>HOR√ÅRIO ESPIRITUAL</h2>

<div class="controls">
    <select id="mes" onchange="trocarPeriodo()">
        <option value="1">Janeiro</option>
        <option value="2">Fevereiro</option>
        <option value="3">Mar√ßo</option>
        <option value="4">Abril</option>
        <option value="5">Maio</option>
        <option value="6">Junho</option>
        <option value="7">Julho</option>
        <option value="8">Agosto</option>
        <option value="9">Setembro</option>
        <option value="10">Outubro</option>
        <option value="11">Novembro</option>
        <option value="12">Dezembro</option>
    </select>

    <input type="number" id="ano" value="2026" onchange="trocarPeriodo()" style="width:90px">

    <br>

    <button onclick="saveData()">üíæ Salvar</button>
    <button onclick="exportCSV()">üì§ Exportar CSV</button>
    <button onclick="window.print()">üñ®Ô∏è Imprimir</button>
    <button onclick="resetTable()">‚ôªÔ∏è Resetar</button>
</div>

<table>
<thead>
<tr>
    <th>INTEN√á√ÉO / A√á√ÉO</th>
    <script>
        for (let i = 1; i <= 31; i++) {
            document.write(`<th>${i}</th>`);
        }
    </script>
</tr>
</thead>

<tbody id="tbody"></tbody>
</table>

<!-- MODAL -->
<div id="modal" class="modal">
  <div class="modal-content">
    <h3>Preencher dia</h3>

    <select id="selectOpcao">
      <option value="">‚Äî Selecione ‚Äî</option>
      <option>‚úî Feito</option>
      <option>‚úñ N√£o feito</option>
      <option>‚ñ≥ Parcial</option>
      <option>üôè Ora√ß√£o</option>
      <option>üìñ Leitura</option>
      <option>üí™ Sacrif√≠cio</option>
      <option>üïäÔ∏è Oferecido</option>
    </select>

    <input type="text" id="textoLivre" placeholder="Ou escreva algo...">

    <br><br>

    <button onclick="salvarModal()">Salvar</button>
    <button onclick="fecharModal()">Cancelar</button>
  </div>
</div>

<script>
const secoes = [
    "Vincula√ß√£o comigo mesmo",
    "Vincula√ß√£o com Deus",
    "Vincula√ß√£o com os outros",
    "Vincula√ß√£o com o trabalho"
];

const tbody = document.getElementById("tbody");
let celulaAtual = null;

function montarTabela() {
    tbody.innerHTML = "";
    secoes.forEach(secao => {
        tbody.innerHTML += `
            <tr><td class="section" colspan="32">${secao}</td></tr>
            <tr>
                <td><b>Inten√ß√£o</b></td>
                ${"<td class='editable' onclick='openModal(this)'></td>".repeat(31)}
            </tr>
            <tr>
                <td><b>A√ß√£o</b></td>
                ${"<td class='editable' onclick='openModal(this)'></td>".repeat(31)}
            </tr>
        `;
    });
}

function chaveStorage() {
    return "horario_" + document.getElementById("mes").value + "_" + document.getElementById("ano").value;
}

function saveData() {
    const data = Array.from(document.querySelectorAll(".editable")).map(c => c.innerText);
    localStorage.setItem(chaveStorage(), JSON.stringify(data));
}

function loadData() {
    document.querySelectorAll(".editable").forEach(c => c.innerText = "");
    const saved = localStorage.getItem(chaveStorage());
    if (!saved) return;
    const data = JSON.parse(saved);
    document.querySelectorAll(".editable").forEach((c, i) => c.innerText = data[i] || "");
}

function trocarPeriodo() {
    montarTabela();
    loadData();
}

function openModal(celula) {
    celulaAtual = celula;
    document.getElementById("modal").style.display = "block";
    document.getElementById("selectOpcao").value = "";
    document.getElementById("textoLivre").value = "";
}

function fecharModal() {
    document.getElementById("modal").style.display = "none";
}

function salvarModal() {
    const s = document.getElementById("selectOpcao").value;
    const t = document.getElementById("textoLivre").value;
    if (s) celulaAtual.innerText = s;
    else if (t) celulaAtual.innerText = t;
    fecharModal();
    saveData();
}

function exportCSV() {
    let csv = "";
    document.querySelectorAll("tr").forEach(row => {
        let cols = [];
        row.querySelectorAll("th, td").forEach(col => {
            cols.push(`"${col.innerText}"`);
        });
        csv += cols.join(";") + "\n";
    });
    const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "horario_espiritual.csv";
    link.click();
}

function resetTable() {
    if (!confirm("Apagar este m√™s?")) return;
    localStorage.removeItem(chaveStorage());
    loadData();
}

const hoje = new Date();
document.getElementById("mes").value = hoje.getMonth() + 1;
document.getElementById("ano").value = hoje.getFullYear();

montarTabela();
loadData();
</script>

</body>
</html>
