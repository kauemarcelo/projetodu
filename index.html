<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>HorÃ¡rio Espiritual</title>

<style>
body {
    font-family: Arial, sans-serif;
    margin: 20px;
}

h2 {
    text-align: center;
}

.controls {
    text-align: center;
    margin-bottom: 10px;
}

select, input {
    padding: 6px;
    margin: 4px;
}

button {
    margin: 4px;
    padding: 6px 12px;
    cursor: pointer;
}

table {
    width: 100%;
    border-collapse: collapse;
    font-size: 12px;
}

th, td {
    border: 1px solid #000;
    text-align: center;
    padding: 4px;
    min-width: 28px;
}

th {
    background: #f0f0f0;
}

.section {
    background: #d9d9d9;
    font-weight: bold;
}

.editable {
    cursor: pointer;
}

.editable:hover {
    background: #ffffcc;
}

/* MODAL */
.modal {
    display: none;
    position: fixed;
    z-index: 999;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.6);
}

.modal-content {
    background: #fff;
    padding: 20px;
    width: 300px;
    margin: 20% auto;
    border-radius: 6px;
    text-align: center;
}

.modal-content button {
    width: 90%;
}

@media print {
    .controls { display: none; }
}
</style>
</head>

<body>

<h2>HORÃRIO ESPIRITUAL</h2>

<div class="controls">
    <select id="mes" onchange="trocarPeriodo()">
        <option value="1">Janeiro</option>
        <option value="2">Fevereiro</option>
        <option value="3">MarÃ§o</option>
        <option value="4">Abril</option>
        <option value="5">Maio</option>
        <option value="6">Junho</option>
        <option value="7">Julho</option>
        <option value="8">Agosto</option>
        <option value="9">Setembro</option>
        <option value="10">Outubro</option>
        <option value="11">Novembro</option>
        <option value="12">Dezembro</option>
    </select>

    <input type="number" id="ano" onchange="trocarPeriodo()" style="width:90px">

    <br>

    <button onclick="saveData()">ğŸ’¾ Salvar</button>
    <button onclick="enviarWhatsApp()">ğŸ“² Enviar por WhatsApp (Eduardo)</button>
    <button onclick="window.print()">ğŸ–¨ï¸ Imprimir</button>
    <button onclick="resetTable()">â™»ï¸ Resetar mÃªs</button>
</div>

<table>
<thead>
<tr>
    <th>INTENÃ‡ÃƒO / AÃ‡ÃƒO</th>
    <script>
        for (let i = 1; i <= 31; i++) document.write(`<th>${i}</th>`);
    </script>
</tr>
</thead>

<tbody id="tbody"></tbody>
</table>

<!-- MODAL -->
<div id="modal" class="modal">
  <div class="modal-content">
    <h3>Editar dia</h3>

    <select id="selectOpcao">
      <option value="">â€” Selecione â€”</option>
      <option>âœ” Feito</option>
      <option>âœ– NÃ£o feito</option>
      <option>â–³ Parcial</option>
      <option>ğŸ™ OraÃ§Ã£o</option>
      <option>ğŸ“– Leitura</option>
      <option>ğŸ’ª SacrifÃ­cio</option>
      <option>ğŸ•Šï¸ Oferecido</option>
    </select>

    <input type="text" id="textoLivre" placeholder="Ou escreva algo...">

    <br>

    <button onclick="salvarModal()">ğŸ’¾ Salvar alteraÃ§Ã£o</button>
    <button onclick="apagarCelula()">ğŸ—‘ Apagar conteÃºdo</button>
    <button onclick="fecharModal()">Cancelar</button>
  </div>
</div>

<script>
const secoes = [
    "VinculaÃ§Ã£o comigo mesmo",
    "VinculaÃ§Ã£o com Deus",
    "VinculaÃ§Ã£o com os outros",
    "VinculaÃ§Ã£o com o trabalho"
];

const tbody = document.getElementById("tbody");
let celulaAtual = null;

function montarTabela() {
    tbody.innerHTML = "";
    secoes.forEach(secao => {
        tbody.innerHTML += `
            <tr><td class="section" colspan="32">${secao}</td></tr>
            <tr>
                <td><b>IntenÃ§Ã£o</b></td>
                ${"<td class='editable' onclick='openModal(this)'></td>".repeat(31)}
            </tr>
            <tr>
                <td><b>AÃ§Ã£o</b></td>
                ${"<td class='editable' onclick='openModal(this)'></td>".repeat(31)}
            </tr>
        `;
    });
}

function chaveStorage() {
    return "horario_" + mes.value + "_" + ano.value;
}

function saveData() {
    const data = [...document.querySelectorAll(".editable")].map(c => c.innerText);
    localStorage.setItem(chaveStorage(), JSON.stringify(data));
}

function loadData() {
    document.querySelectorAll(".editable").forEach(c => c.innerText = "");
    const saved = localStorage.getItem(chaveStorage());
    if (!saved) return;
    const data = JSON.parse(saved);
    document.querySelectorAll(".editable").forEach((c, i) => c.innerText = data[i] || "");
}

function trocarPeriodo() {
    montarTabela();
    loadData();
}

function openModal(celula) {
    celulaAtual = celula;
    modal.style.display = "block";
    const valor = celula.innerText;
    selectOpcao.value = valor;
    textoLivre.value = valor && !valor.match(/^[âœ”âœ–â–³ğŸ™ğŸ“–ğŸ’ªğŸ•Šï¸]/) ? valor : "";
}

function fecharModal() {
    modal.style.display = "none";
}

function salvarModal() {
    if (selectOpcao.value) celulaAtual.innerText = selectOpcao.value;
    else celulaAtual.innerText = textoLivre.value;
    fecharModal();
    saveData();
}

function apagarCelula() {
    if (!confirm("Apagar este conteÃºdo?")) return;
    celulaAtual.innerText = "";
    fecharModal();
    saveData();
}

function enviarWhatsApp() {
    let texto = `HorÃ¡rio Espiritual - ${mes.options[mes.selectedIndex].text}/${ano.value}\n\n`;
    document.querySelectorAll("tr").forEach(row => {
        let linha = [];
        row.querySelectorAll("td").forEach(col => {
            if (col.innerText.trim()) linha.push(col.innerText);
        });
        if (linha.length) texto += linha.join(" | ") + "\n";
    });
    const numero = "5511932275530";
    window.open(`https://wa.me/${numero}?text=${encodeURIComponent(texto)}`, "_blank");
}

function resetTable() {
    if (!confirm("Apagar todo este mÃªs?")) return;
    localStorage.removeItem(chaveStorage());
    loadData();
}

const hoje = new Date();
mes.value = hoje.getMonth() + 1;
ano.value = hoje.getFullYear();

montarTabela();
loadData();
</script>

</body>
</html>
